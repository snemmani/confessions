language: python
dist: xenial
python: 3.7
install:
- cd confessions-rest && pip install -r requirements.txt
stages:
- test
jobs:
  include:
  - stage: test
    script:
    - coverage run --source='.' manage.py test --settings=confessions_rest.settings_unittest
    - coverage xml
    - cd .. && sonar-scanner
env:
- DJANGO_SETTINGS_MODULE: confessions_rest.settings_unittest
addons:
  sonarcloud:
    organization: snemmani
deploy:
  provider: heroku
  api_key:
    secure: ebBlbkJEQmgAk5pHQTHjcQXeIZgZ6xpp+obNC7tPWvoy+YCIRjOFDNGGzbO/JEmtpSUYTLIJC+u6ocWLcLP2uDoNqZS2jUbI5T3nEyhLVNYpnF5XJ3PqDWKGQH0HyGPu6b5ZW8p+mmK+X3FifCo5DK63ccHsujIp6VMf3ztNBS/yp1MyOoNzP4J2F/Tr0cpQ/F+4b9GpnqNZjgukRV90T3FhCCgmtGrzbVIO9Wey0MZXdG+W7ParDbvCDHEnj4TcZSmnT+WzG3a5f/5glCX+R6oSldR5E9HEPGnzhvalhuxBdPAYdmcjYy5JvpIhJarypbqU6UIdC/G5ToRRRUovM34hMHhIzq28k0Qpa/HYPgO0oZtvx1iNjIKS5glj+UKnqMVVYAreeldrpqregyi9/+U4kQ3RygLqUQ6wMGmIHphBohmWN9VPHsqOVOJHn0ypefG6waVkIiLmMhpFaqbwkjYZ6iel1nvgPFyJUFkmbnXdPAsTXJSXDecC9/VEOurbyhtmAgvJbCRE5rWlTn088zDHS078LNrjWJul9Plgitx6DOuYky+zVuJGKZaU7r33bC66gHZDfKJH/nCj9tXAe8yhwZEK1rJxkDZchTE32ER3GsGjpG4Lxui+NL+B3mH4LuRPY+Ig5GCM5iHaAiT8fbEDKm3rZlFoFk0tU81WaAE=
  app: confessions-asns
  on:
    repo: snemmani/confessions
    branch: develop
  skip_cleanup: 'true'
